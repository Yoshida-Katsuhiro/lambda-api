version: 0.2

phases:
  install:
    commands:
      # 1. Node.jsã®ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
      - echo Installing Serverless Framework and dependencies...
      - npm install
      # 2. Serverless Frameworkã‚’å®‰å®šç‰ˆã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³3ç³»ã«å›ºå®šã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
      - npm install -g serverless@3 

  build:
    commands:
      # 1. ğŸ’¡ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè¡Œ
      # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã§ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ã¨ä»®å®š
      - echo Running database migrations...
      - npm run migrate # ã¾ãŸã¯ npx knex migrate:latest ãªã©

      # 2. Serverless Frameworkã‚’ä½¿ã£ã¦RDSã¨Lambdaã‚’ãƒ‡ãƒ—ãƒ­ã‚¤
      - echo Deploying via Serverless Framework...
      - sls deploy --stage dev 
  

artifacts:
  files:
    - '**/*'